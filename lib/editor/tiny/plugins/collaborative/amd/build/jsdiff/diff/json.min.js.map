{"version":3,"file":"json.min.js","sources":["../../../src/jsdiff/diff/json.js"],"sourcesContent":["import Diff from './base';\nimport {lineDiff} from './line';\n\nexport const jsonDiff = new Diff();\n// Discriminate between two lines of pretty-printed, serialized JSON where one of them has a\n// dangling comma and the other doesn't. Turns out including the dangling comma yields the nicest output:\njsonDiff.useLongestToken = true;\n\njsonDiff.tokenize = lineDiff.tokenize;\njsonDiff.castInput = function(value, options) {\n  const {undefinedReplacement, stringifyReplacer = (k, v) => typeof v === 'undefined' ? undefinedReplacement : v} = options;\n\n  return typeof value === 'string' ? value : JSON.stringify(canonicalize(value, null, null, stringifyReplacer), stringifyReplacer, '  ');\n};\njsonDiff.equals = function(left, right, options) {\n  return Diff.prototype.equals.call(jsonDiff, left.replace(/,([\\r\\n])/g, '$1'), right.replace(/,([\\r\\n])/g, '$1'), options);\n};\n\nexport function diffJson(oldObj, newObj, options) { return jsonDiff.diff(oldObj, newObj, options); }\n\n// This function handles the presence of circular references by bailing out when encountering an\n// object that is already on the \"stack\" of items being processed. Accepts an optional replacer\nexport function canonicalize(obj, stack, replacementStack, replacer, key) {\n  stack = stack || [];\n  replacementStack = replacementStack || [];\n\n  if (replacer) {\n    obj = replacer(key, obj);\n  }\n\n  let i;\n\n  for (i = 0; i < stack.length; i += 1) {\n    if (stack[i] === obj) {\n      return replacementStack[i];\n    }\n  }\n\n  let canonicalizedObj;\n\n  if ('[object Array]' === Object.prototype.toString.call(obj)) {\n    stack.push(obj);\n    canonicalizedObj = new Array(obj.length);\n    replacementStack.push(canonicalizedObj);\n    for (i = 0; i < obj.length; i += 1) {\n      canonicalizedObj[i] = canonicalize(obj[i], stack, replacementStack, replacer, key);\n    }\n    stack.pop();\n    replacementStack.pop();\n    return canonicalizedObj;\n  }\n\n  if (obj && obj.toJSON) {\n    obj = obj.toJSON();\n  }\n\n  if (typeof obj === 'object' && obj !== null) {\n    stack.push(obj);\n    canonicalizedObj = {};\n    replacementStack.push(canonicalizedObj);\n    let sortedKeys = [],\n        key;\n    for (key in obj) {\n      /* istanbul ignore else */\n      if (Object.prototype.hasOwnProperty.call(obj, key)) {\n        sortedKeys.push(key);\n      }\n    }\n    sortedKeys.sort();\n    for (i = 0; i < sortedKeys.length; i += 1) {\n      key = sortedKeys[i];\n      canonicalizedObj[key] = canonicalize(obj[key], stack, replacementStack, replacer, key);\n    }\n    stack.pop();\n    replacementStack.pop();\n  } else {\n    canonicalizedObj = obj;\n  }\n  return canonicalizedObj;\n}\n"],"names":["e","oldObj","newObj","options","jsonDiff","diff","_base","__esModule","default","_exports","Diff","canonicalize","obj","stack","replacementStack","replacer","key","i","canonicalizedObj","length","Object","prototype","toString","call","push","Array","pop","toJSON","sortedKeys","hasOwnProperty","sort","useLongestToken","tokenize","lineDiff","castInput","value","undefinedReplacement","stringifyReplacer","k","v","JSON","stringify","equals","left","right","replace"],"mappings":"2GAA0B,IAAAA,+GAkBnB,SAAkBC,OAAQC,OAAQC,SAAW,OAAOC,SAASC,KAAKJ,OAAQC,OAAQC,QAAU,2BAlBnGG,OAA0BN,EAA1BM,QAA0BN,EAAAO,WAAAP,EAAAQ,CAAAA,QAAAR,GAGnB,MAAMI,SAAQK,SAAAL,SAAG,IAAIM,MAAIF,QAmBzB,SAASG,aAAaC,IAAKC,MAAOC,iBAAkBC,SAAUC,KAQnE,IAAIC,EAQAC,iBANJ,IATAL,MAAQA,OAAS,GACjBC,iBAAmBA,kBAAoB,GAEnCC,WACFH,IAAMG,SAASC,IAAKJ,MAKjBK,EAAI,EAAGA,EAAIJ,MAAMM,OAAQF,GAAK,EACjC,GAAIJ,MAAMI,KAAOL,IACf,OAAOE,iBAAiBG,GAM5B,GAAI,mBAAqBG,OAAOC,UAAUC,SAASC,KAAKX,KAAM,CAI5D,IAHAC,MAAMW,KAAKZ,KACXM,iBAAmB,IAAIO,MAAMb,IAAIO,QACjCL,iBAAiBU,KAAKN,kBACjBD,EAAI,EAAGA,EAAIL,IAAIO,OAAQF,GAAK,EAC/BC,iBAAiBD,GAAKN,aAAaC,IAAIK,GAAIJ,MAAOC,iBAAkBC,SAAUC,KAIhF,OAFAH,MAAMa,MACNZ,iBAAiBY,MACVR,gBACT,CAMA,GAJIN,KAAOA,IAAIe,SACbf,IAAMA,IAAIe,UAGO,iBAARf,KAA4B,OAARA,IAAc,CAC3CC,MAAMW,KAAKZ,KACXM,iBAAmB,CAAA,EACnBJ,iBAAiBU,KAAKN,kBACtB,IACIF,IADAY,WAAa,GAEjB,IAAKZ,OAAOJ,IAENQ,OAAOC,UAAUQ,eAAeN,KAAKX,IAAKI,MAC5CY,WAAWJ,KAAKR,KAIpB,IADAY,WAAWE,OACNb,EAAI,EAAGA,EAAIW,WAAWT,OAAQF,GAAK,EACtCD,IAAMY,WAAWX,GACjBC,iBAAiBF,KAAOL,aAAaC,IAAII,KAAMH,MAAOC,iBAAkBC,SAAUC,KAEpFH,MAAMa,MACNZ,iBAAiBY,KACnB,MACER,iBAAmBN,IAErB,OAAOM,gBACT,CAzEAd,SAAS2B,iBAAkB,EAE3B3B,SAAS4B,SAAWC,MAAAA,SAASD,SAC7B5B,SAAS8B,UAAY,SAASC,MAAOhC,SACnC,MAAMiC,qBAACA,qBAAoBC,kBAAEA,kBAAoBA,CAACC,EAAGC,SAAmB,IAANA,EAAoBH,qBAAuBG,GAAKpC,QAElH,MAAwB,iBAAVgC,MAAqBA,MAAQK,KAAKC,UAAU9B,aAAawB,MAAO,KAAM,KAAME,mBAAoBA,kBAAmB,OAEnIjC,SAASsC,OAAS,SAASC,KAAMC,MAAOzC,SACtC,OAAOO,MAAIF,QAACa,UAAUqB,OAAOnB,KAAKnB,SAAUuC,KAAKE,QAAQ,aAAc,MAAOD,MAAMC,QAAQ,aAAc,MAAO1C,SAgElH"}