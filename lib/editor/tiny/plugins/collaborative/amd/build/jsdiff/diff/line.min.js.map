{"version":3,"file":"line.min.js","sources":["../../../src/jsdiff/diff/line.js"],"sourcesContent":["import Diff from './base';\nimport {generateOptions} from '../util/params';\n\nexport const lineDiff = new Diff();\nlineDiff.tokenize = function(value, options) {\n  if(options.stripTrailingCr) {\n    // remove one \\r before \\n to match GNU diff's --strip-trailing-cr behavior\n    value = value.replace(/\\r\\n/g, '\\n');\n  }\n\n  let retLines = [],\n      linesAndNewlines = value.split(/(\\n|\\r\\n)/);\n\n  // Ignore the final empty token that occurs if the string ends with a new line\n  if (!linesAndNewlines[linesAndNewlines.length - 1]) {\n    linesAndNewlines.pop();\n  }\n\n  // Merge the content and line separators into single tokens\n  for (let i = 0; i < linesAndNewlines.length; i++) {\n    let line = linesAndNewlines[i];\n\n    if (i % 2 && !options.newlineIsToken) {\n      retLines[retLines.length - 1] += line;\n    } else {\n      retLines.push(line);\n    }\n  }\n\n  return retLines;\n};\n\nlineDiff.equals = function(left, right, options) {\n  // If we're ignoring whitespace, we need to normalise lines by stripping\n  // whitespace before checking equality. (This has an annoying interaction\n  // with newlineIsToken that requires special handling: if newlines get their\n  // own token, then we DON'T want to trim the *newline* tokens down to empty\n  // strings, since this would cause us to treat whitespace-only line content\n  // as equal to a separator between lines, which would be weird and\n  // inconsistent with the documented behavior of the options.)\n  if (options.ignoreWhitespace) {\n    if (!options.newlineIsToken || !left.includes('\\n')) {\n      left = left.trim();\n    }\n    if (!options.newlineIsToken || !right.includes('\\n')) {\n      right = right.trim();\n    }\n  } else if (options.ignoreNewlineAtEof && !options.newlineIsToken) {\n    if (left.endsWith('\\n')) {\n      left = left.slice(0, -1);\n    }\n    if (right.endsWith('\\n')) {\n      right = right.slice(0, -1);\n    }\n  }\n  return Diff.prototype.equals.call(this, left, right, options);\n};\n\nexport function diffLines(oldStr, newStr, callback) { return lineDiff.diff(oldStr, newStr, callback); }\n\n// Kept for backwards compatibility. This is a rather arbitrary wrapper method\n// that just calls `diffLines` with `ignoreWhitespace: true`. It's confusing to\n// have two ways to do exactly the same thing in the API, so we no longer\n// document this one (library users should explicitly use `diffLines` with\n// `ignoreWhitespace: true` instead) but we keep it around to maintain\n// compatibility with code that used old versions.\nexport function diffTrimmedLines(oldStr, newStr, callback) {\n  let options = generateOptions(callback, {ignoreWhitespace: true});\n  return lineDiff.diff(oldStr, newStr, options);\n}\n"],"names":["e","oldStr","newStr","callback","lineDiff","diff","options","generateOptions","ignoreWhitespace","_base","__esModule","default","_exports","Diff","tokenize","value","stripTrailingCr","replace","retLines","linesAndNewlines","split","length","pop","i","line","newlineIsToken","push","equals","left","right","includes","trim","ignoreNewlineAtEof","endsWith","slice","prototype","call","this"],"mappings":"qHAA0B,IAAAA,6EA0DnB,SAAmBC,OAAQC,OAAQC,UAAY,OAAOC,SAASC,KAAKJ,OAAQC,OAAQC,SAAW,4BAQ/F,SAA0BF,OAAQC,OAAQC,UAC/C,IAAIG,SAAU,EAAAC,QAAeA,iBAACJ,SAAU,CAACK,kBAAkB,IAC3D,OAAOJ,SAASC,KAAKJ,OAAQC,OAAQI,QACvC,2BArEAG,OAA0BT,EAA1BS,QAA0BT,EAAAU,WAAAV,EAAAW,CAAAA,QAAAX,GAGnB,MAAMI,SAAQQ,SAAAR,SAAG,IAAIS,MAAIF,QAChCP,SAASU,SAAW,SAASC,MAAOT,SAC/BA,QAAQU,kBAETD,MAAQA,MAAME,QAAQ,QAAS,OAGjC,IAAIC,SAAW,GACXC,iBAAmBJ,MAAMK,MAAM,aAG9BD,iBAAiBA,iBAAiBE,OAAS,IAC9CF,iBAAiBG,MAInB,IAAK,IAAIC,EAAI,EAAGA,EAAIJ,iBAAiBE,OAAQE,IAAK,CAChD,IAAIC,KAAOL,iBAAiBI,GAExBA,EAAI,IAAMjB,QAAQmB,eACpBP,SAASA,SAASG,OAAS,IAAMG,KAEjCN,SAASQ,KAAKF,KAElB,CAEA,OAAON,UAGTd,SAASuB,OAAS,SAASC,KAAMC,MAAOvB,SAuBtC,OAfIA,QAAQE,kBACLF,QAAQmB,gBAAmBG,KAAKE,SAAS,QAC5CF,KAAOA,KAAKG,QAETzB,QAAQmB,gBAAmBI,MAAMC,SAAS,QAC7CD,MAAQA,MAAME,SAEPzB,QAAQ0B,qBAAuB1B,QAAQmB,iBAC5CG,KAAKK,SAAS,QAChBL,KAAOA,KAAKM,MAAM,GAAI,IAEpBL,MAAMI,SAAS,QACjBJ,MAAQA,MAAMK,MAAM,GAAI,KAGrBrB,MAAIF,QAACwB,UAAUR,OAAOS,KAAKC,KAAMT,KAAMC,MAAOvB,SActD"}